
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sohan's Blog</title>
  <meta name="author" content="SM Sohan">

  
  <meta name="description" content="I like the idea of learning one new programming language every year. This is also mentioned at The Pragmatic Programmer Book. I&#8217;m now looking &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://smsohan.com/blog/page/9/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="" rel="alternate" title="Sohan's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37549931-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Sohan's Blog</a></h1>
  
    <h2>Things I'm Learning</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:smsohan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/home">Home</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/lifeline">Lifeline!</a></li>
  <li><a href="/blog/2013/04/05/call-me-sohan-and-ask-me-not-about-sm/">Call me Sohan!</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/12/what-programming-language-should-i-learn-in-2013/">What Programming Language Should I Learn in 2013?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-12T16:11:00-07:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I like the idea of learning one new programming language every year. This is also mentioned at <a href="http://pragprog.com/book/tpp/the-pragmatic-programmer">The Pragmatic Programmer Book</a>. I&#8217;m now looking for a new language to learn.</p>

<p>In 2011, I learned <a href="http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/">F#</a>, my first functional programming language experience. It&#8217;s a really nice language, especially if you&#8217;re familiar with the .Net class library and the windows development echo system in general. This was really fun, learned the basic concepts and building blocks of functional languages.</p>

<p>The direct impact of F# is, even if I&#8217;m not using F#, I&#8217;m consciously using the concepts in other languages. For example, Ruby comes with a handful of functional style methods in its <a href="http://www.ruby-doc.org/core-1.9.3/Array.html">Array/Enumerable API</a>, and so does UnderscoreJS. Not just that, I&#8217;m always watching for opporunities to reduce side-effects, use delayed execution and pass around blocks when it makes sense. Learning F# has improved my Ruby/JavaScript/C# coding as a direct result. One disclaimer here, I&#8217;ve failed to grasp the true concepts of <a href="" title="http://en.wikipedia.org/wiki/Monad_(category_theory)">Category Theory and Monads</a>, although I understand how to use these.</p>

<p>I also learned ObjectiveC in 2011 while working on a project with ThoughtWorks. This was fun, apart from the frustrations with the IDE. As a language, I actually liked it quite a lot, the way they handle dynamic message passing while still giving you compile errors looked really innovative to me. I believe there&#8217;s a lot of room for me to learn more about ObjectiveC and Cocoa framework in general. Please let me know if there&#8217;s a good open source project where I can see professional level ObjectiveC code.</p>

<p>2012 was my year of learning JavaScript. Don&#8217;t get me wrong, I&#8217;ve been writing JavaScript for some time now, but I think I really learned the language in 2012. Thanks to the influx of micro libraries, as well as their coolness, and seriousness. CoffeeScript made me immensely happy, too. Started writing a JavaScript book with <a href="http://isagoksu.com/">Isa Goksu</a>, too bad we didn&#8217;t get far with it :(</p>

<p>I&#8217;m yet to pick a new language for 2013. Any suggestion? Or, what are you learning in 2013?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/the-myth-of-one-assert-per-test/">The Myth of One Assert Per Test</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-06T09:55:00-07:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>TL;DR; It&#8217;s not one <code>assert</code> per test, rather one logical path per test.</p></blockquote>

<p>I find this to be a classical example of how an inappropriate choice of terminology leads to huge confusion. In trying to find the original source of the &#8220;one assertion per test&#8221; quote, google came back only with a bunch of confused blog entries :(</p>

<p>Without much ranting, lets see a code example to start with:</p>

<figure class='code'><figcaption><span>example code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">eligible_credit_card_types</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">annual_income</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="n">annual_income</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">100_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;platinum&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">10_000</span><span class="p">),</span>
</span><span class='line'>     <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">8_000</span><span class="p">),</span>
</span><span class='line'>     <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">5_000</span><span class="p">)</span> <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">50_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">6_000</span><span class="p">),</span>
</span><span class='line'>    <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">3_000</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">30_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">1_500</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="o">[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>By saying one logical path per test, I mean I&#8217;d write a total of 4 tests for this method, each covering a logical path. But I really don&#8217;t care about how many assert calls you need in each logical path to express the desired behavior. For example, this is totally fine:</p>

<figure class='code'><figcaption><span>example test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">context</span> <span class="s1">&#39;#eligible_credit_card_types&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;returns platinum, gold and cashback for people making over a 100K annually&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1">#setup customer, call the method</span>
</span><span class='line'>    <span class="n">cards</span> <span class="o">=</span> <span class="n">credit_card_authorizer</span><span class="o">.</span><span class="n">eligible_credit_card_types</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cards</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">cards</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">type</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">&#39;platinum&#39;</span>
</span><span class='line'>    <span class="n">cards</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">limit</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">10_000</span>
</span><span class='line'>    <span class="c1">#same for cards[1], cards[2]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, this can indeed be converted into a single assertion, if you already had <code>equals</code> method overriden for the credit cards. But, I&#8217;d probably skip adding that code if its just for the sake of writing tests.</p>

<p><img class="right" src="/images/bowling.jpg" width="300" height="550">
<i>Image taken from mchenrybowl</i></p>

<p>The mechnical thought of &#8220;one assertion per test&#8221; is lame.</p>

<ol>
<li>If for nothing else, these silly assertions would multipy the running time of your test suite by a factor of digits.</li>
<li>Doesn&#8217;t provide you any additional coverage or safety.</li>
<li>As long as each of your tests cover a unique logical path, there&#8217;s only one logical reason why it&#8217;d fail, irrespective of how many assertions you put in there.</li>
</ol>


<p>But, there&#8217;s a but! If you need many asserts per test, the code is probably asking for some refactoring. It indicates that one logical path in your code is touching too many things. Worse, when it calls too many methods that belong to other objects. Testing such a logical path is hard, usually requires a big setup and a bigger assertion. In such cases, breaking down the test into multiple tests may yield some superficial readability of the test, but certainly works around the actual problem in the code without fixing it. Almost always, this indicates long procedural methods and I&#8217;d suggest taking a second look at it to refactor into a more OO code.</p>

<p>Happy Friday!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/28/readable-unit-tests/">Readable Unit Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-28T10:10:00-07:00" pubdate data-updated="true">Nov 28<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From my experience with writing/reading unit tests for years, here&#8217;s a little guideline to keep &#8216;em readable:</p>

<ol>
<li>A unit test needs to fit entirely (including setups) on a screen without scrolling.</li>
<li>It is OK to have a little bit of duplication in unit tests for readability.</li>
<li>Avoid nesting of contexts beyond 2 levels. Instead, use methods to setup and flatten.</li>
<li>Do not use if/else/loops in a unit test.</li>
<li>If your test needs too much setup/mocking/stubbing, time to refactor the code.</li>
</ol>


<p>A simple readable unit test is only achievable when the code itself is simple. Adhereing to these guideline will probably make the code simpler as a direct impact!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/27/unit-testing-asynchronous-side-effects/">Unit Testing and Sleep</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-27T15:01:00-07:00" pubdate data-updated="true">Nov 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If your unit test code needs a sleep, its time to refactor it. Ideally, you&#8217;d only need to stub/mock the asynchronous call instead of introducing arbitrary sleeps in the test code, because they will eventually fail. Moreover, until it fails, it will slow down your test runner.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/23/seed-data-in-a-rails-project/">Seed Data in a Rails Project</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-23T13:18:00-07:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Most applications I&#8217;ve worked on required some kind of seed data. For example, I&#8217;ve used seed data to create a super admin user so the site can actually be used upon a fresh install. Some other common cases include things like, list of credit card types, names of countries/states etc. This post is about some ideas to manage thsese seed data in a Ruby on Rails project.</p>

<h3>Where to put the seed data?</h3>

<p>I think you have 2 choices to pick from.</p>

<ol>
<li>db/seeds.rb</li>
<li>db/migrate/2342423424_some_migration.rb</li>
</ol>


<p>I prefer having it in the seeds.rb whenever possible since this is the obvious place for it. But I&#8217;ve often put them in migrations as well. There are trade-offs associated with both.</p>

<p>Migrations only run once. This means, &#8220;double/miltiple seeding&#8221; is not a concern at all. So, you can write a migration with some seeding command as follows:</p>

<figure class='code'><figcaption><span>Migration CreateUsers</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span>
</span><span class='line'>      <span class="n">u</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'>      <span class="n">u</span><span class="o">.</span><span class="n">email</span>
</span><span class='line'>      <span class="n">u</span><span class="o">.</span><span class="n">encrypted_password</span>
</span><span class='line'>      <span class="n">u</span><span class="o">.</span><span class="n">password_salt</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">create_super_admin_user</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">create_super_admin_user</span>
</span><span class='line'>
</span><span class='line'>    <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;SuperAdmin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="s1">&#39;super@mysite.com&#39;</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This works great. It creates the super user and by virtue of migrations, it only ever creates one super admin.</p>

<p>The caveat with this approach is, if you change certain things later, then this migration will fail to run. For example, say we added a required field to user as follows:</p>

<figure class='code'><figcaption><span>User</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>    <span class="n">validates</span> <span class="ss">:age</span><span class="p">,</span> <span class="n">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you run the migration on a freshly checked out code, it will fail due to this validation. One workaround is to fix the code in this migration. But for people that already ran the migrations, and likely your production environment already did so, this has no effect. At this point, it starts getting complicated and some band-aid solutions are usually implemented.</p>

<p>On the other hand, if you are using db/seeds.rb for seed data, you&#8217;d have to make sure its idempotent. So, a rerun should not create a 2nd copy of the objects. As a start, your code could be like this:</p>

<figure class='code'><figcaption><span>db/seeds.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">if</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="s1">&#39;super@mysite.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">blank?</span>
</span><span class='line'>    <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;SuperAdmin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="s1">&#39;super@mysite.com&#39;</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>With this in place, you can easily incorporate the change for the new validation as follows:</p>

<figure class='code'><figcaption><span>db/seeds.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">super_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="s1">&#39;super@mysite.com&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">super_user</span> <span class="o">&amp;&amp;</span> <span class="n">super_user</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">blank?</span>
</span><span class='line'>    <span class="n">super_user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="mi">20</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">age</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">&#39;SuperAdmin&#39;</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="s1">&#39;super@mysite.com&#39;</span><span class="p">,</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This would work for people who already had a super user and also for people that just got a fresh copy of the code.</p>

<blockquote><p>So, I prefer putting data in seeds.rb with idempotency.</p></blockquote>

<p>In addition to handling such cases, it also makes it easy for anyone to take glance at the seed data in one place.</p>

<h3>How to handle large amount of seed data?</h3>

<p>When you have more than a handful of data to seed, I&#8217;d recommend tidying up your db/seeds.rb into a more manageable structure. Here&#8217;s how I&#8217;d do it:</p>

<figure class='code'><figcaption><span>File organization</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  |- app
</span><span class='line'>  |- db
</span><span class='line'>    - seeds.rb
</span><span class='line'>    |- seeds
</span><span class='line'>      - users.rb
</span><span class='line'>      - credit_card_types.rb
</span></code></pre></td></tr></table></div></figure>


<p>With this structure in place, you can turn you seeds.rb into a simple manifesto file as follows:</p>

<figure class='code'><figcaption><span>seeds.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="nb">require</span> <span class="s1">&#39;seeds/users&#39;</span>
</span><span class='line'>  <span class="nb">require</span> <span class="s1">&#39;seeds/credit_card_types&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This will help you keeping things organized and hopefully give you a happier solution to the seed data problem.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/06/orm-or-not/">ORM or Not?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-06T09:39:00-07:00" pubdate data-updated="true">Nov 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yes to ORM, No to custom queries. Here&#8217;s a bullet list:</p>

<ol>
<li>You&#8217;d probably end up writing your own ORM anyway.</li>
<li>Doing so, you&#8217;d spend <strong>a lot of money</strong> writing library level code instead of your business logic.</li>
<li>The time tested ones are likely to be <strong>better than yours</strong>.</li>
<li>Beware, you&#8217;d have to figure out some <strong>complex issues</strong>: connection pooling, concurrency/locking, caching, transactions, updates, versioning, documentation etc.</li>
</ol>


<p>If you find yourself ORM is falling short of what you need, you&#8217;re either presenting information overload or using a transactional database as a reporting store.</p>

<p>In this article, I mean ORM to be an object database mapping, so it applies to both SQL/NoSQL databases.</p>

<p>Disagree? I&#8217;d like to find your opinion in the comments.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/25/development-environments-and-dependencies-hell/">Development Environments and Dependency Hell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-25T21:51:00-06:00" pubdate data-updated="true">Oct 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It used to be pretty straight forward to get up and running with a Rails app. You&#8217;d expect something like the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone git@blah/blah.git
</span><span class='line'><span class="nb">cd </span>blah
</span><span class='line'>bundle
</span><span class='line'>rake db:migrate
</span><span class='line'>rails s
</span></code></pre></td></tr></table></div></figure>


<p>If the project is using rvm and bundler, the ruby versions and gem depdendencies are all taken care of. So far life is good this way.</p>

<p>But it starts getting complicated. For example, your project probably uses MySQL and no matter what, I can&#8217;t remeber all the c libraries that are pre-requisites for the mysql2 gem to actually install successfully. If it uses Nokogiri, get another hit of all the who-knows-what libxml2* libraries that need to be there. Another gem quite commonly used is rmagick with similar c depdencies. Every time I hit these road blocks, I feel so helpless for:</p>

<ul>
<li>I have no idea what is required</li>
<li>Someone on StackOverflow has a magical solution</li>
<li>The solution will work on one unix distro but won&#8217;t on others</li>
</ul>


<p>This starts getting even more complicated as you start adding external project depdendencies. For example, your project will probably need some Queueing, Caching, Emailing, SOA integration etc. And even if you have very good tests, it&#8217;s likely that you&#8217;d want to manually test to see if your project holds up when integrated to other projects. It&#8217;s best to have all these third-party products in your dev box for obvious reasons. But its also super hard to keep everything in sync, because</p>

<ul>
<li>You&#8217;d have to automate the installation of all the third-party products in your dev box</li>
<li>Find a mechanism to update the third-party projects as they change</li>
</ul>


<p>To tackle these problems, teams often use Chef/Puppet/Powershell/Vagrant etc. infrastructure automation tools. In practice, I&#8217;m yet to find a project where these tools would just work in a single pass. For example, it would miss one package or the other, sometimes it would fail at halfway, sometimes it would get you pretty close but almost never I have seen it to work on a single pass. I find this to be a recurring problem, faced by almost all dev teams.</p>

<h2>One solution I think may work is as follows:</h2>

<pre><code>1. Teams from each project writes their own bootstrap scripts, so others can just use it
2. The bootstrap script runs on a CI server and fails a commit if it breaks the bootstrap
3. Nobody runs a manual command ever for bootstrapping the dev machines
</code></pre>

<p>I&#8217;m yet to try this approach in practice. But too many times I&#8217;ve seen there&#8217;s only one/couple people writing the bootstrapping scripts for all projects. Also, nobody really finds the issues until a new dev box needs bootstrapping. A CI server would be a big push to keep it green all the time. And finally, everytime a one-off command is run for bootstrapping, a little part of automation opportunity is missed.</p>

<p>If you&#8217;ve had success with these problems, please share. I&#8217;d really like to learn from you and hopefully implement some of your proven practices/principles.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/22/pairing-vs-code-reviews/">Pair Programming vs. Code Reviews</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-22T20:43:00-06:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/sync_dive.jpeg" alt="Sync Dive" /> Photo credits to http://womendiving.blogspot.ca/2012/08/2012-olympic-games-10m-synchronized.html</p>

<p>Pair programming is like synchronized swimming. You do it together, you win it together. You try to improve your chances by helping your partner, and vice verca. Even if you lose, its highly likely you&#8217;ve improved simply by being together sharing a united goal.</p>

<p>Code review can be fun and really useful too. But deep deep care needs to be taken to ensure it remains same in spirit, that is, the unified shared goal. In practice I have seen it to be super hard to achieve consistently.</p>

<p>Are you pair programming? Are you doing code reviews only? Why/why not? Would you change?</p>

<p>Comments are welcome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/22/joined-sourcefire/">Joined Sourcefire</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-22T19:16:00-06:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello Dear Readers:</p>

<p>I just wanted to inform you that I&#8217;ve joined Sourcefire this morning as a Principal Software Engineer. My primary responsibility will be helping my team with Ruby on Rails and Web technology related expertise. I&#8217;m looking forward to this new role.</p>

<p>ThoughtWorks was a wonderful experience. In the last couple of years with ThoughtWorks, I have worked on 4 different projects, for 4 different clients and business domains from 4 different cities in North America. In a future post I would like to write about the fantastic journey, but for now I just wanted to share the news.</p>

<p>Hopefully, Sourcefire will be an amazing experience as well.</p>

<p>Thank you again for reading my blog.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/11/database-design-sorting-by-computed-fields/">Database Design: Sorting by Concepts on Nullable Fields</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-11T21:05:00-06:00" pubdate data-updated="true">Oct 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a recent project, we had this requirement to sort a list of items by a concept that is absent in the database schema, but can be derived from other fields. To make it easy to understand, let&#8217;s build an example, simple enough to isolate the topic of interest.</p>

<p>Let&#8217;s say we have a list of locations, stored in a database table as follows:</p>

<pre><code>Locations (location_id (primary key), province_id (NULL), city_id (NOT NULL))
</code></pre>

<p>And say, we want to present a list of locations sorted by &#8220;address&#8221;. As you see in this example, &#8220;address&#8221; is a concept, not directly present in the database, but can be derived based on province_id and city_id. So, when we say sort by &#8220;address&#8221;, the SQL query may look like the follwing:</p>

<figure class='code'><figcaption><span>query to sort by address</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Locations</span> <span class="k">order</span> <span class="k">by</span> <span class="n">province_id</span><span class="p">,</span> <span class="n">city_id</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you take a second look at the schema, you&#8217;ll see the <code>province_id</code> is <code>Nullable</code>. And if you are familiar with SQL, you already know that a <code>NULL</code> does not equal another <code>NULL</code>. So, for rows with <code>province_id = NULL</code>, the secondary sort on city_id has no effect at all. As a result, the expected sort by &#8220;address&#8221; cannot be derived by using this simple <code>order by</code> clause.</p>

<p>There are a few work arounds to it. One obvious workaround is to change the DB schema and make the <code>province_id</code> NOT NULL in favor of a placeholder, for example, &#8220;Not Available&#8221;. This would eliminate the problem altogether. This should be pretty easy to achieve if you have control over the database schema.</p>

<p>But in case this is beyond your control, you&#8217;d have to hack your query and sleep with the noisy butterfly in your stomach. Such a poorman&#8217;s solution would be to put a <code>"case ... when ... else... end..."</code> in the query.</p>

<p>The reason I wanted to share this post is, if your project needs to sort by such a computed concept, here&#8217;s what you should probably:</p>

<ol>
<li>Say &#8220;No&#8221; to it.</li>
<li>Change your database to incorporate the concept as a column in some table.</li>
<li>At the very least, make sure you&#8217;re not sorting on a Nullable field.</li>
<li>Repeat 1-3 in order.</li>
</ol>


<p>Thanks for reading. Keep crafting good software.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2021/04/23/architecture-mongodb/">Software Architecture - Topic 5 - MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/03/04/architecture-redis/">Software Architecture - Topic 4 - Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/02/19/frontend-engineering/">Can I Have a Career as a Frontend Engineer?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/01/17/software-architecture-part-3-writing/">Software Architecture - Topic 3: Writing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/01/16/what-drives-me/">What Drives Me?</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>LinkedIn Profile</h1>
  <p>
    <a href="http://www.linkedin.com/in/sohan">SM Sohan</a>
  </p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/smsohan">@smsohan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'smsohan',
            count: ,
            skip_forks: ,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - SM Sohan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
