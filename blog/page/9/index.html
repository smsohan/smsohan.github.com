
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sohan's Blog</title>
  <meta name="author" content="SM Sohan">

  
  <meta name="description" content="Photo credits to http://womendiving.blogspot.ca/2012/08/2012-olympic-games-10m-synchronized.html Pair programming is like synchronized swimming. You &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://smsohan.com/blog/page/9/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="" rel="alternate" title="Sohan's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37549931-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Sohan's Blog</a></h1>
  
    <h2>Things I'm Learning</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:smsohan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/home">Home</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/lifeline">Lifeline!</a></li>
  <li><a href="/blog/2013/04/05/call-me-sohan-and-ask-me-not-about-sm/">Call me Sohan!</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/22/pairing-vs-code-reviews/">Pair Programming vs. Code Reviews</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-22T20:43:00-06:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/sync_dive.jpeg" alt="Sync Dive" /> Photo credits to http://womendiving.blogspot.ca/2012/08/2012-olympic-games-10m-synchronized.html</p>

<p>Pair programming is like synchronized swimming. You do it together, you win it together. You try to improve your chances by helping your partner, and vice verca. Even if you lose, its highly likely you&#8217;ve improved simply by being together sharing a united goal.</p>

<p>Code review can be fun and really useful too. But deep deep care needs to be taken to ensure it remains same in spirit, that is, the unified shared goal. In practice I have seen it to be super hard to achieve consistently.</p>

<p>Are you pair programming? Are you doing code reviews only? Why/why not? Would you change?</p>

<p>Comments are welcome.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/22/joined-sourcefire/">Joined Sourcefire</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-22T19:16:00-06:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Hello Dear Readers:</p>

<p>I just wanted to inform you that I&#8217;ve joined Sourcefire this morning as a Principal Software Engineer. My primary responsibility will be helping my team with Ruby on Rails and Web technology related expertise. I&#8217;m looking forward to this new role.</p>

<p>ThoughtWorks was a wonderful experience. In the last couple of years with ThoughtWorks, I have worked on 4 different projects, for 4 different clients and business domains from 4 different cities in North America. In a future post I would like to write about the fantastic journey, but for now I just wanted to share the news.</p>

<p>Hopefully, Sourcefire will be an amazing experience as well.</p>

<p>Thank you again for reading my blog.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/11/database-design-sorting-by-computed-fields/">Database Design: Sorting by Concepts on Nullable Fields</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-11T21:05:00-06:00" pubdate data-updated="true">Oct 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In a recent project, we had this requirement to sort a list of items by a concept that is absent in the database schema, but can be derived from other fields. To make it easy to understand, let&#8217;s build an example, simple enough to isolate the topic of interest.</p>

<p>Let&#8217;s say we have a list of locations, stored in a database table as follows:</p>

<pre><code>Locations (location_id (primary key), province_id (NULL), city_id (NOT NULL))
</code></pre>

<p>And say, we want to present a list of locations sorted by &#8220;address&#8221;. As you see in this example, &#8220;address&#8221; is a concept, not directly present in the database, but can be derived based on province_id and city_id. So, when we say sort by &#8220;address&#8221;, the SQL query may look like the follwing:</p>

<figure class='code'><figcaption><span>query to sort by address</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Locations</span> <span class="k">order</span> <span class="k">by</span> <span class="n">province_id</span><span class="p">,</span> <span class="n">city_id</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you take a second look at the schema, you&#8217;ll see the <code>province_id</code> is <code>Nullable</code>. And if you are familiar with SQL, you already know that a <code>NULL</code> does not equal another <code>NULL</code>. So, for rows with <code>province_id = NULL</code>, the secondary sort on city_id has no effect at all. As a result, the expected sort by &#8220;address&#8221; cannot be derived by using this simple <code>order by</code> clause.</p>

<p>There are a few work arounds to it. One obvious workaround is to change the DB schema and make the <code>province_id</code> NOT NULL in favor of a placeholder, for example, &#8220;Not Available&#8221;. This would eliminate the problem altogether. This should be pretty easy to achieve if you have control over the database schema.</p>

<p>But in case this is beyond your control, you&#8217;d have to hack your query and sleep with the noisy butterfly in your stomach. Such a poorman&#8217;s solution would be to put a <code>"case ... when ... else... end..."</code> in the query.</p>

<p>The reason I wanted to share this post is, if your project needs to sort by such a computed concept, here&#8217;s what you should probably:</p>

<ol>
<li>Say &#8220;No&#8221; to it.</li>
<li>Change your database to incorporate the concept as a column in some table.</li>
<li>At the very least, make sure you&#8217;re not sorting on a Nullable field.</li>
<li>Repeat 1-3 in order.</li>
</ol>


<p>Thanks for reading. Keep crafting good software.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/02/mvcmailer-new-api/">MvcMailer New API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-02T10:23:00-06:00" pubdate data-updated="true">Oct 2<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>With the help of <a href="http://codecuriosity.com/">@TylerMercier</a>, and many active users of MvcMailer, we have just released the new API for MvcMailer. This is a summary post capturing the work and lessons learned in the process.</p>

<p>The bulk of the work has been done on removing hard dependencies on dll files for 3rd party libraries in favor of NuGet packages. For example, we used NUnit, for running our tests. Instead of referencing the dlls directly, we are now using the NuGet package. This will help the contributors to get up and running with the source code without having to worry about the depedencies being in the right place.</p>

<p>NuGet command line also added a dependency as a Nuget package!</p>

<p>But this cleanup is not gonna be directly visible to the users of MvcMailer. If you install MvcMailer today, you should see a few changes as follows:</p>

<ol>
<li>MvcMailer now uses T4Scaffolding 1.0.7 instead of the older version that was causing issue with ASP.NET MVC 4.</li>
<li>MvcMailer package is now exclusively for ASP.NET MVC 4. And a new package MvcMailer3 is published for ASP.NET MVC3. After looking into options, we found this was probably the best way to release an upgrade, while still remaining compatible with MVC3.</li>
<li>The MailerBase has a sweet new API. The old API still works, but I&#8217;d highly discourage using it. This is how it&#8217;d look:</li>
</ol>


<figure class='code'><figcaption><span>Example code showing old API</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">class</span> <span class="nc">WelcomeMailer</span> <span class="p">:</span> <span class="n">MailerBase</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">MailMessage</span> <span class="nf">Welcome</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">var</span> <span class="n">mailMessage</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MailMessage</span><span class="p">(){</span><span class="n">Subject</span> <span class="p">=</span> <span class="err">&#39;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">world</span><span class="p">!</span><span class="err">&#39;</span><span class="p">};</span>
</span><span class='line'>    <span class="n">mailMessage</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;hello@example.com&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">PopulateBody</span><span class="p">(</span><span class="n">mailMessage</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">Welcome</span><span class="err">&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">mailMessage</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see here, the old API would require you to initialize your own <code>MailMessage</code>, set some parameters to it and then hand it over to MailerBase so it can render the view into its body.</p>

<p>We found it would be nice to reverse this workflow using lambdas. So, there&#8217;s a new populate method, that will call you back with an already instantiated <code>MvcMailMessage</code> object so you can set its properties as required. <code>MvcMailMessage</code> is an extension of <code>MailMessage</code> from the core .Net library, with new properties added so you can specify the <code>ViewName, MasterName, LinkedResources</code> etc.</p>

<p>So, with this new API, the code from above will look like the following:</p>

<figure class='code'><figcaption><span>Example code with the new API</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">class</span> <span class="nc">WelcomeMailer</span> <span class="p">:</span> <span class="n">MailerBase</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">MvcMailMessage</span> <span class="nf">Welcome</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="nf">Populate</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">x</span><span class="p">.</span><span class="n">Subject</span> <span class="p">=</span> <span class="err">&#39;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">the</span> <span class="n">world</span><span class="p">!</span><span class="err">&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">x</span><span class="p">.</span><span class="n">ViewName</span> <span class="p">=</span> <span class="err">&#39;</span><span class="n">Welcome</span><span class="err">&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">x</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;hello@example.com&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you see here, the new API provides a nice way get rid of some of the repiting parts of your mailer code. This API is available on both MvcMailer3 and MvcMailer.</p>

<p>We&#8217;d like to hear your feedback on this new API. Thank you for using MvcMailer.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/09/13/lovejs-presentation-at-camug/">LoveJS Presentation at CAMUG</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-09-13T21:32:00-06:00" pubdate data-updated="true">Sep 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I paired with <a href="http://codecuriosity.com">@TylerMercier</a> as we did a little <a href="http://www.meetup.com/Calgary-Agile-Methods-User-Group/events/79722562/">hands-on demo on writing testable and OO JavaScript</a>.</p>

<p><img src="/images/LoveJS.jpg" alt="Presenting with Tyler" /></p>

<p>This was mostly based on our pairing experience on the current project, but also had things that we learned from our previous web projects. I wanted to share some of the highlights of this session with my readers on this blog:</p>

<p>From experience, I have seen a few charactersitics that make JavaScript coding a real fun. Here&#8217;s a few that stand out:</p>

<blockquote><p>Good JavaScript is Testable and Object Oriented</p></blockquote>

<p>Really simple stuff, but it took me quite a few years to actually start writing OO JavaScript, and more so, to write automated tests that run on CI server. As I often say, the shittiest part of most web projects is its CSS, with its hacks, and the inherent nature of it. And JavaScript is often just as smelly. But if you just start writing OO JavaScript with tests, your code will drive you to a cleaner path simply because bad code makes testing really tough. And with Jasmine, testing JavaScript is super fun. So, we suggested the following toolset:</p>

<ol>
<li>CoffeeScript</li>
<li>Jasmine</li>
<li>PhantomJS</li>
<li>CI integration</li>
</ol>


<p>The materials related to this session are available online at <a href="http://codecuriosity.com/love_javascript">github</a>.</p>

<p>It was a great turnout, full house, engaged audience, and, asking really good questions. I had a lot of fun doing the hands-on. You know live demos can be daunting, especially when you are writing on a low res screen so people can actually read the projected text. But thanks a lot to Tyler, we had done a couple dry runs of the demo. That helped us a lot in terms of finding the points to transition between us, as well as some muscle memory as we were writing the code live in front of the audience.</p>

<p>But, I also wanted to share a checklist that we should have done as a preparation for this talk. It&#8217;s too bad, we didn&#8217;t do the following, hopefully this will be better next time. Here&#8217;s what I have in my mind:</p>

<ul>
<li><strong>Audio/video record</strong> the session. So, I can see myself afterwards and find some obvious rooms for improvement.</li>
<li>Practice using <strong>real projector</strong> so we can find the best theme for the room size. This time I felt some of the text colors weren&#8217;t as readable for the back benchers.</li>
<li>Never plan for a 50 minute talk when you have a 60 minute slot. Leave <strong>at least 20 minutes slack</strong>. Have a backup plan for an extension in case you are done early. It sucks to cut short or rush to the ending.</li>
</ul>


<p>But in retrospect, I was super impressed with how the session ran. Hopefully, with practice it will only keep getting better.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/07/deploying-a-java-application-using-capistrano/">Deploying a Java Application Using Capistrano</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-07T20:18:00-06:00" pubdate data-updated="true">Aug 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In our current project, we have a little Java Bridge, that reads JMS messages from an enterprise service bus (ESB) and pipes it to an ActiveMQ topic. This had to be written in Java, or some flavor of it like JRuby/Scala, because the ESB only allows their signed client libraries to interact with their API.</p>

<p>Since, we were already using Capistrano to deploy our Rails/Nginx app, we wanted to leverage the same tool for deploying the Java Bridge. This would also make maintenance easier, since the same standards is used for deploy locations/log files/roations etc.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/05/design-of-a-mongodb-analytics-database/">Design of a MongoDB Analytics Database</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-05T17:38:00-06:00" pubdate data-updated="true">Aug 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We built a MongoDB based realtime analytics solution and learned a few things in the process. I would like to share some of our learnings in this post.</p>

<p>When tasked to find a good database for holding realtime analytics data, I was searching through the wisdom of internet to come up with a good choice. At a high level, the database needed to deliver the following:</p>

<ol>
<li>Atomic counters so that events could be counted fast. For example, count up the Total Sales metric for each sale event.</li>
<li>Unique sets. For example, unique set of buyers who bought anything today.</li>
<li>Simple lookups. For example, when a sale happens, it needs to lookup the original price to calculate the profit on the fly.</li>
<li>Indexing on multiple fields. For example, a product lookup may be by its ID as well as by a combination of other fields.</li>
<li>Fast at doing 1-4, so it can keep up with the event stream in realtime.</li>
</ol>


<p>It became pretty clear that, the internet was favoring either Redis or MongoDB for such requirements. I did a little spike using both, and settled down on MongoDB. This was becauase, MongoDB had better support for performing lookups and indexing. Also, the document oriented nature of MongoDB suited well with the Object Oriented models, leaning towards a more direct match between the two worlds. Redis is awesome for doing increments and set operations, but it would require some application level handling of OO -> DB interfacing as well as intelligent lookups. So, MongoDB was the winner for the job.</p>

<p>If you&#8217;ve watched the video at <a href="http://www.10gen.com/events/analytics-with-mongodb">the mongodb blog</a> you know it&#8217;s quite straight forward to design a document for holding realtime analytics data.</p>

<blockquote><p>The key design goal is: precopute the metrics in the required aggregation levels.</p></blockquote>

<p>This design goal is applicable to pretty much all reporting/dashboarding projects. Since it&#8217;s common to aggregate different types of data on a dashboard, without precomputing the results, it would test anyone&#8217;s patience before the report is ready. In our case, the dashboard mostly displays data for the day in realtime. So, a simplified text only view would display the following:</p>

<pre>
###Sunday, August 5, 2012

* Total Sold: 2,500
* Total Profit: $ 1,345,427
* Proft Margin: 5.09%
* Buyers: 311
* Sellers: 126

####Online

* Total Sold: 400
* Total Profit: $ 98,762
* Proft Margin: 7.1%
* Buyers: 114
* Sellers: 28

####In Stores

* Total Sold: 2,100
* Total Profit: $ 124,666,5
* Proft Margin: 4.91%
* Buyers: 257
* Sellers: 110
</pre>


<p>As discussed above, for a faster (and sane!) response time, the data better be precomputed in the database. So, to hold this precomputed data, we have designed a document like the following example:</p>

<pre>
metric: {
  event_date: '2010/08/05',
  channel: 'online',
  total_sold: 2100,
  total_buying_price: 112,567,432,
  total_selling_price: 123,875,127,
  buyers: ['buyer 1', 'buyer 2'],
  sellers: ['seller 1', 'seller 2']
}
</pre>


<p>And there is a document like this for each channel, for each day. This simple document is suitable for producing the desired report. Of course, in the real project, we need more data points in the report as well as aggregation levels beyond just a day and a channel. And you guessed it right, we have a document like this example one for each required aggregation level.</p>

<p>This design has held pretty well for our project. This is simple, there&#8217;s a direct match between what is shown and what is stored. The data is already grouped, so queries simply fetch the documents without needing to perform any major computation on the fly. This model makes it trivial to add a new data point, as well as a new reporting aggregation level.</p>

<p>But the challenge is to make sure we can in fact keep a document like this up-to-date as events happen in realtime without falling behind. Let&#8217;s talk about it in the upcoming post.</p>

<p>If you haven&#8217;t had a chance to read the previous post in this series, here&#8217;s a link to <a href="http://blog.smsohan.com/blog/2012/07/28/deploying-to-TV-screens/">Deploying to TV Screens</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/28/deploying-to-TV-screens/">Deploying to TV Screens</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-28T15:28:00-06:00" pubdate data-updated="true">Jul 28<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Off late, I am working on a project to render real time business data with interesting visualizations, so people can feel the pulse of the business. For the last couple of months, I have been planning to write a detailed post about it. But after a few false starts, I am finally settling on smaller posts, telling a small part of the story each time.</p>

<blockquote><p>So, have you ever worked on a web application that is primarily viewed through 55&#8221;+ 1080p TV screens?</p></blockquote>

<p>We are showing real time business data, aggregated from multiple data sources as they are happening. The screens are gonna be mounted on the wall, like as you&#8217;d see in the airports. And it needs to be running 24x7</p>

<p>This introduces an interesting deployment challenge:</p>

<blockquote><p>How would you reload the screen every time you re-deploy the app?</p></blockquote>

<p>A regular web app is interactive. So, when we re-deploy the app, the users typically get the latest version as soon as they reload the page or navigate through the app. However, in an airport like setting, where information is displayed across many screens, and typically no-one is clicking it, the app needs to be aware of updates and reload itself to achieve the same. This is essential, for example, if there&#8217;s an API change on the server side, the HTML/Javascript/CSS must be in sync to be able render it.</p>

<p><img src="http://farm1.staticflickr.com/65/212623519_eae543d64c.jpg" alt="Airport displays" /></p>

<p>Photo credits to  5mal5</p>

<p>The app itself uses JSON API calls to render the live data. Each screen is somewhat like a single page app, using multiple AJAX calls to render different parts of the screen, showing different data. The API calls are all funneled through a single Javascript module. The module looks like the following (showing a simplified version for brevity):</p>

<div><script src='https://gist.github.com/3194417.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>


<p>If you have noticed here, there&#8217;s an extra check inside the success callback. To begin with, the page remembers the server token on reload. So, whenever there&#8217;s a new token, it refreshes the page. Since all API calls are funneled through this module, this becomes a no-brainer to support new screens/API calls.</p>

<p>Our API&#8217;s respond with a server token, which is guaranteed to:</p>

<ol>
<li>Remain same for each server deployment, and</li>
<li>Change whenever there&#8217;s a new deployment.</li>
</ol>


<p>However, we still need to make sure the server token indeed ensures these two essential properties. With a little trick, this becomes trivial. For our app, we are using Capistrano to deploy our Ruby on Rails project. For those new to Capistrano, it uses a timestamped directory for each deploy, symlinking it to the current. So, it looks somewhat like the following:</p>

<div><script src='https://gist.github.com/3194484.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>


<p>Every Ruby on Rails app also comes with a little method, Rails.root that returns the full path to the directory of the current deployment. So, in this example scenario, we get the following:</p>

<p>Rails.root #==&gt; /app/realtime/releases/20120729083021</p>

<p>Since every deployment will be a new timestamp, this method ensures a unique token for each deployment. That&#8217;s all we need for the api module to be aware of new deployments and auto refreshes. Here&#8217;s an example controller/action (again, simplified for brevity):</p>

<div><script src='https://gist.github.com/3194430.js?file='></script>
<noscript><pre><code></code></pre></noscript></div>


<p>I liked the organic nature of this technique. It is harvesting on the available tools. Although the examples in this post show Ruby/Rails as an example, I am sure the same techniques can be applied to other technologies with the same simplicity.</p>

<p>Before I conclude, I would share one limitation of this technique here. Since the page reload happens on a shared api module, the reload needs to be generic, without requiring any special knowledge about the pages to reload. This pretty much means, a page needs to be able to reconstruct itself entirely from it&#8217;s URL. Requiring any Javascript state beyond the URL, would probably require API specific handling to reload, killing the advantage of this technique. But the good news is, its always a good practice to rely solely on the URL to construct a page.</p>

<p>Thanks a ton if you&#8217;ve followed all the way. Stay tuned for the upcoming posts, where I will be telling the story of handling multiple API calls on a page, highlighting data changes and some other interesting bits about a real time dashboard.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/30/my-take-on-client-side-mvc/">My Take on Client-Side MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-30T00:00:00-06:00" pubdate data-updated="true">Mar 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">I just rolled off my last project this Wednesday. It was a great team, worked on some cutting edge technologies, mobile web, HTML5, mongo and some other fun stuff. Now that I got two &#8220;beach&#8221; days before jumping on to the next gig, I spent some time trying out Backbonejs to knockout one item from the long list of to-dos. This post is about my initial take on client side MVC, solely based on these two days with <a href="http://documentcloud.github.com/backbone/">Backbonejs</a>.<br /><br /><h2 style="text-align: left;">Summary</h2><blockquote class="tr_bq">Client-side MVC is in its infancy, but promises a bright future</blockquote><div><br /></div><div><h2 style="text-align: left;">The Good</h2></div><div>Writing &#8220;clean code&#8221; while doing Javascript can be quite a challenge. Doing MVC gets you a step closer to that by splitting responsibility among models, views and controllers. So, your Javascript code will be domain driven, instead of just a bunch of monolithic methods.</div><div><br /></div><div>Your client-side MVC application can be very responsive, or even a &#8221;<a href="http://en.wikipedia.org/wiki/Single-page_application">single page app</a>&#8221;. This is an advantage if your app needs some data from the server, but can leverage Javascript for most of its visual needs. For example, a real-time analytics dashboard can use client-side MVC to do most of the processing on the client side after fetching the data from the server.</div><div><br /></div><div>Backbonejs offers event wiring API between your models and views. For example, say you have a model called Vehicle and a view called VehicleView, you can put the following code to wire up the &#8220;change&#8221; event on the model so that the view renders whenever the model is updated.<br /><br /></div><script src="https://gist.github.com/2252292.js">  </script> <br />Using such events, it becomes a trivial process to keep all the views in sync with the models as they change across different actions.<br /><br />Another advantage of client-side MVC is, it forces &#8221;<a href="http://en.wikipedia.org/wiki/Eating_your_own_dog_food">eat your own dog food</a>&#8221; as you are essentially creating an API on your server and using it first hand on the client side. So, if you are building multiple clients, for example, native mobile clients and browser web apps, you can leverage the same API.<br /><br /><h2 style="text-align: left;">The Bad</h2>Ever since Ruby on Rails came into the game, we all became keen on having conventions. Can&#8217;t speak for the rest of the client-side MVC projects, but Backbonejs definitely lacks in this regard. It doesn&#8217;t default to any view template. Also, it doesn&#8217;t have a default project structure. And even worse, no in-built testing recipe either. This means, you are left on your own to choose and debate about each of these, and more that just these, to find a standard set of tools for your project.<br /><br /><blockquote class="tr_bq">Having no in-built test framework reduces the emphasis on testing, this is a Big Big lacking.</blockquote><br />I find the backbonejs MVC to be a little&nbsp;weird, they have Model and View, but no Controller. Instead they have a Router and a confused concept of Collection. So, for example, if you wanted to work on a resource called Vehicle, you will probably end up with the following &#8220;classes&#8221;:<br /><br />Vehicle model, Vehicles collection, Vehicle view, Vehicles view and Vehicle router<br /><br />But as you can see here, there is no Vehicle controller. I know you can always write a controller on your own, but thats the whole point about having strong opinionated conventions.<br /><br />The relation between a Collection and its Model can be confusing, specially when wiring up events. For example, a change in a model can trigger the view for the model and/or the view for its collection. The logic for handling/bubbling such events can get quite messy at times.<br /><br /><h2 style="text-align: left;">The Future</h2>It took several years for server side MVC to find a good common set of conventions and tools. Then, it took a few more years for people to get used to the goodness of it. I think client-side MVC frameworks will hit a similar sweet spot, but only after we give it some time to settle on the conventions and build intelligent tools around those.<br /><br /><br /><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
MVC might not be proper wrt javascript. here is a good read http://addyosmani.github.com/backbone-fundamentals/</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/22/are-you-still-parsing-html-element-ids/">Are You Still Parsing HTML Element Ids?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-22T00:00:00-07:00" pubdate data-updated="true">Jan 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on">To render a list, often times we use repeated HTML elements with a similar template. For example, the search results in ebay.com is a list of divs, each containing different data in the same template. In a server side, this rendering code is somewhat similar to this:<br /><div><br /></div><script src="https://gist.github.com/1660430.js"></script><br />If you noticed, a product with it&#8217;s database id = 123 will be rendered inside a div with id=&#8221;product_123&#8221;, and similarly div id=&#8221;product_456&#8221; will contain the product with id = 456.<br /><br />With such ids, we can write JavaScript code that can extract the database id of a selected product to do interesting things, for example:<br /><br /><script src="https://gist.github.com/1660456.js">  </script><br />This is a useful and a common technique. However, in this era of <a href="http://dev.w3.org/html5/spec/Overview.html#embedding-custom-non-visible-data-with-the-data-attributes">HTML5</a>, we can make use of its custom attributes feature to write a clean JavaScript event handler without the help of parsing. Here&#8217;s an example:<br /><br /><script src="https://gist.github.com/1660524.js">  </script><br />I will never parse my HTML element Id again. What about you?</div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Cronos</div>
<div class='content'>
nice!, I didt know this function, tks for sharing!</div>
</div>
<div class='comment'>
<div class='author'>honeyclarck</div>
<div class='content'>
In my point of view You sure did put a new twist on something that Ive heard so much about <b><a href="http://www.actualexams.me/" rel="nofollow">ActualExams</a></b>. And How did you manage to make a blog that as smart as it is sleek?</div>
</div>
</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2020/12/24/you-are-unfrogettable/">You are Unfrogattable</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/07/tribute-to-rails-date-time-great-invisible-design/">A Tribute to Time Travel APIs in Ruby on Rails</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/28/tips-for-developer-demos/">Tips for Great Developer Demos</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/18/where-to-learn/">Where to Learn: 10 Ways I Do</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/11/12/learn-to-get-and-give-feedback/">Learn to Get and Give Feedback</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>LinkedIn Profile</h1>
  <p>
    <a href="http://www.linkedin.com/in/sohan">SM Sohan</a>
  </p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/smsohan">@smsohan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'smsohan',
            count: ,
            skip_forks: ,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - SM Sohan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
