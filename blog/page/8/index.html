
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sohan's Blog</title>
  <meta name="author" content="SM Sohan">

  
  <meta name="description" content="This following list is probably a subset of a bigger one, but I&#8217;ve composed it based on my experience using BackboneJS + Rails on the current &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://smsohan.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="" rel="alternate" title="Sohan's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37549931-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Sohan's Blog</a></h1>
  
    <h2>Things I'm Learning</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:smsohan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/home">Home</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/lifeline">Lifeline!</a></li>
  <li><a href="/blog/2013/04/05/call-me-sohan-and-ask-me-not-about-sm/">Call me Sohan!</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/25/practial-challenges-with-client-side-mvc/">Practical API Design Challenges for Client Side MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-25T22:40:00-07:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This following list is probably a subset of a bigger one, but I&#8217;ve composed it based on my experience using BackboneJS + Rails on the current project at work. So, here goes the list:</p>

<h3>Designing Granularity of the API</h3>

<p>Using RESTful API, it makes sense to have separate API methods to repesent each type of resource. However, to construct a meaninful UI for the end user, often time we need to represent multiple resources on the same screen. Let&#8217;s explain this with an example requirement:</p>

<p>As a user I want to see the <strong>emails</strong> using a saved <strong>custom filter</strong></p>

<p>In this case, we would want the UI to show the description of the selected filter, and also the emails matching the filter. Conceptually, <code>CustomFilter</code> and <code>Email</code> are two resources or models, having distinct properties and behaviors. It&#8217;d make sense to have two separate API&#8217;s as follows:</p>

<p><strong>Filter API:</strong>
GET http://fancy_domain.com/filters/emails_from_boss_about_release</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="err">id:</span> <span class="err">10,</span>
</span><span class='line'>  <span class="err">filter_name:</span> <span class="err">emails_from_boss_about_release,</span>
</span><span class='line'>  <span class="err">subject_including:</span> <span class="err">&#39;release&#39;,</span>
</span><span class='line'>  <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Email API:</strong>
GET http://fancy_domain.com/filters/10/emails</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">subject:</span> <span class="err">&#39;Release</span> <span class="err">note&#39;,</span>
</span><span class='line'>    <span class="err">from:</span> <span class="nt">&quot;boss@the_company.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">to:</span> <span class="nt">&quot;sohan@the_company.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">body:</span> <span class="nt">&quot;&lt;html&gt;.. &lt;/html&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">sent_at:</span> <span class="nt">&quot;20130102040511&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Although this granularity makes good sense as an API, it starts causing issues for typical client side MVC use case.</p>

<blockquote><p>Unless the data from these two API methods are combined on the server side, the client must make two requests.</p></blockquote>

<p>In a real world use, I&#8217;ve seen it&#8217;s more common for the UI to require multiple resources than not. Since, we want our users to get faster response, we try to create API&#8217;s that suit the UI&#8217;s need. So, APIs start getting bloated payloads to match the UI&#8217;s need. This typically results into something like the following:</p>

<p><strong>Filter Email API:</strong>
GET http://fancy_domain.com/filters/emails_from_boss_about_release?include_emails=true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="err">id:</span> <span class="err">10,</span>
</span><span class='line'>  <span class="err">filter_name:</span> <span class="err">&#39;emails_from_boss_about_release&#39;,</span>
</span><span class='line'>  <span class="err">subject_including:</span> <span class="err">&#39;release&#39;,</span>
</span><span class='line'>  <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;,</span>
</span><span class='line'>  <span class="err">emails:</span>
</span><span class='line'>  <span class="err">[</span>
</span><span class='line'>    <span class="err">{</span>
</span><span class='line'>      <span class="err">subject:</span> <span class="err">&#39;Release</span> <span class="err">note&#39;,</span>
</span><span class='line'>      <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;,</span>
</span><span class='line'>      <span class="err">to:</span> <span class="err">&#39;sohan@the_company.com&#39;,</span>
</span><span class='line'>      <span class="err">body:</span> <span class="err">&#39;&lt;html&gt;..</span> <span class="err">&lt;/html&gt;&#39;,</span>
</span><span class='line'>      <span class="err">sent_at:</span> <span class="err">20130102040511</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">]</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is an example with just two resources. I&#8217;ve seen UI&#8217;s that need more than two resources, and its quite common as well.</p>

<h3>Short/Medium/Long form of Models/Resources</h3>

<p>The view usually renders a subset of all possible attributes associated with a model.</p>

<p>For example, when rendering the <code>WeatherForecast</code> model, in the list view only the minimum and maximum temperature for the day with a short summary of Sunny/Cloudy/Rainy/Snowy are shown. However, when you want to see more, you&#8217;d want to show the hourly variation of the weather with additional data of interest.</p>

<p>This requires the RESTful API to prepare multiple respresentations of a resource to suit the specific UI needs. This can complicate the logic on both the server and client sides, since the code must accommodate different representations for the same model.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/07/activerecord-callbacks/">Are ActiveRecord Callbacks Any Good?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-07T09:04:00-07:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Wanted to share my thoughts on ActiveRecord Callbacks. I&#8217;d like to know your thoughts if you disagree. Please use the comments.</p>

<ul>
<li>Only use them when the behavior is <b>must have</b> under all situations, including your tests. For example, we know email addresses are case-insensitive. So no matter what, we may always want to store a lower cased version in the db.</li>
</ul>


<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Good</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:downcase_email</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">downcase_email</span>
</span><span class='line'>    <span class="n">email</span><span class="o">.</span><span class="n">downcase!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Never use them otherwise. A couple of classic examples that I consider as bad:</li>
</ul>


<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Bad: Sends email, probably not required under all situations such as when creating via migrations, tests etc.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_create</span> <span class="ss">:welcome</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">welcome</span>
</span><span class='line'>    <span class="no">WelcomeMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Bad: Interacts with external components</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_create</span> <span class="ss">:setup_orientation</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup_orientation</span>
</span><span class='line'>    <span class="no">OrientationMessageQueue</span><span class="o">.</span><span class="n">enque</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>A common problem with the callbacks is, there are some handy methods that skip the callbacks. For example, consider the following:</li>
</ul>


<figure class='code'><figcaption><span>User.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Careful</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:update_coordinates</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update_coordinates</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="no">Geo</span><span class="o">.</span><span class="n">find_coordinates</span><span class="p">(</span><span class="n">zip_code</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#works fine</span>
</span><span class='line'><span class="n">sohan</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s1">&#39;Sohan&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">sohan</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="s1">&#39;33333&#39;</span>
</span><span class='line'><span class="n">sohan</span><span class="o">.</span><span class="n">save!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#doesn&#39;t fire the callback</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">update_all</span><span class="p">({</span><span class="n">zip_code</span><span class="p">:</span> <span class="s1">&#39;33333&#39;</span><span class="p">},</span> <span class="p">{</span><span class="n">zip_code</span><span class="p">:</span> <span class="s1">&#39;55555&#39;</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&#8217;re using the callbacks, I&#8217;d emphasize again, only use when you are absolutely sure the desired behavior applies under all contexts.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/24/rejecting-because-it-didnt-work-last-time/">Rejecting Because It Didn&#8217;t Work Last Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-24T11:09:00-07:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&#8230; is as right as &#8220;the weather will be bad today because it wasn&#8217;t any good yesterday&#8221;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/21/on-activerecord-query-enhancers/">On ActiveRecord Query Enhancers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-21T16:43:00-07:00" pubdate data-updated="true">Jan 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The question is, should we use the third-party ActiveRecord Query Enhancers like SearchLogic/Squeel/MetaSearch?</p>

<p>Quoting from <a href="https://github.com/ernie/squeel">Squeel&#8217;s Github README</a> page,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Squeel</span> <span class="n">lets</span> <span class="n">you</span> <span class="n">rewrite</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">where</span> <span class="o">[</span><span class="s1">&#39;created_at &gt;= ?&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="n">weeks</span><span class="o">.</span><span class="n">ago</span><span class="o">]</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">as</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">where</span><span class="p">{</span><span class="n">created_at</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">.</span><span class="n">weeks</span><span class="o">.</span><span class="n">ago</span><span class="p">}</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">thing</span><span class="o">.</span> <span class="no">If</span> <span class="n">you</span> <span class="n">don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">agree</span><span class="p">,</span> <span class="no">Squeel</span> <span class="n">might</span> <span class="ow">not</span> <span class="n">be</span> <span class="k">for</span> <span class="n">you</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>At work, we are migrating a Rails 3.0 project into Rails 3.2. We used MetaSearch in the project quite extensively and now discussing if using Squeel (successor of MetaSearch for newer Rails versions) would be a good decision. I recognized there are good points on both sides of the debate and wanted to capture the list here for a reference.</p>

<h3>You&#8217;d want to use such enhancers because:</h3>

<ol>
<li>They extend the basic AR API to provide a DSL. For example, Squeel provides you an API so you can write the following:
<code>User.where{ country != "USA" &amp;&amp; drives_truck == true }</code>
Instead of this Activ eRecord Query:
<code>User.where('country &lt;> ? &amp;&amp; drives_truck = ? ', 'USA', true)</code></li>
<li>They write complex join statements, including outer joins and joining multiple tables, for you using a shorthand. e.g. <code>User.where{company_name_eq 'Coders'}</code></li>
<li>They support negative logic (not equal, not in) and OR SQL queries that would require raw String queries using ActiveRecord API.</li>
<li>They provide fancy operations such as <code>User.where{name_or_address_contains 'scott'}</code> that would require some raw String when using AR directly.</li>
</ol>


<h3>You&#8217;d avoid using these enhancers because:</h3>

<ol>
<li>You think that using String is just fine over using a Hash with hardcoded symbols anyway.</li>
<li>As new versions of AR are released, there&#8217;s little guarantee the third-party API will still be compatible.</li>
<li>You are concerned about adding another pile of abstractions and magic on top of ActiveRecord.</li>
</ol>


<p>Please share if you prefer one over another and if you do, please let us know why.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/17/abusing-json/">MongoDB Is Abusing JSON!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-17T16:11:00-07:00" pubdate data-updated="true">Jan 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I find the MongoDB API is abusing JSON in a really bad way. JSON is probably a good format for storing the documents in MongoDB, but using JSON for it&#8217;s weird API is simply a terrible idea. Here&#8217;s an example from the <a href="http://docs.mongodb.org/manual/reference/sql-aggregation-comparison/">SQL to Aggregation Framework Mapping Chart</a></p>

<figure class='code'><figcaption><span>MongoDB Example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">(</span> <span class="p">[</span>
</span><span class='line'>     <span class="p">{</span> <span class="nx">$group</span><span class="o">:</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="p">{</span> <span class="nx">cust_id</span><span class="o">:</span> <span class="s2">&quot;$cust_id&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nx">ord_date</span><span class="o">:</span> <span class="s2">&quot;$ord_date&quot;</span> <span class="p">},</span>
</span><span class='line'>                 <span class="nx">total</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$sum</span><span class="o">:</span> <span class="s2">&quot;$price&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span> <span class="nx">$match</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">250</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I find the UI of this query to be distasteful at the best. Here&#8217;s an SQL example of the same:</p>

<figure class='code'><figcaption><span>SQL Equivalent</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span>
</span><span class='line'>         <span class="n">ord_date</span><span class="p">,</span>
</span><span class='line'>         <span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total</span>
</span><span class='line'>  <span class="k">FROM</span> <span class="n">orders</span>
</span><span class='line'>  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">ord_date</span>
</span><span class='line'>  <span class="k">HAVING</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">250</span>
</span></code></pre></td></tr></table></div></figure>


<p>I find this SQL example to be a few magnitudes more readable than the JSON one. The JSON query in this example, is full of hacks. Every time I see a &#8220;$&#8221; sign, I&#8217;m totally confused about what it means. For example, consider this fragment, total: { $sum: &#8220;$price&#8221; } and compare it to SUM(price) AS total.</p>

<p>I think MongoDB has its strengths. But for haven&#8217;s sake, if they can&#8217;t find any better, they should leave this JSON ugliness in favor of SQL as a query interface to MongoDB. What do you think?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/08/hybrid-persistence/">Hybrid Persistence</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-08T15:08:00-07:00" pubdate data-updated="true">Jan 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Often times the business requirements demand for database features that aren&#8217;t easily achievable using a single type of database. And now we have quite a few options to choose from, for example Key Value stores, Document databases, Relational databases etc, each providing some mutually exclusive features from the rest. So, it can be tempting to introduce multiple databases to rip the benefits of each.</p>

<p>But, it comes with a few gotchas that are worth knowing. Here&#8217;s a short list from my recent experience on a project:</p>

<ol>
<li>No simple way to join data from multiple databases without multiple round trips.</li>
<li>Deployment is tricky as it adds more infrastructure.</li>
<li>If data is duplicated, migrations need to address multiple sources.</li>
</ol>


<p>Let&#8217;s explain this with an example. Say, we need to store data for an e-commerce site. Document stores seem to be good candidate for storing the product info, since different products have different data associated with it.</p>

<figure class='code'><figcaption><span>products.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">id:</span> <span class="err">&#39;4wqrqw4890ipoip&#39;,</span>
</span><span class='line'>    <span class="err">name:</span> <span class="err">&#39;iPhone</span> <span class="err">5&#39;,</span>
</span><span class='line'>    <span class="err">color:</span> <span class="err">&#39;Black&#39;,</span>
</span><span class='line'>    <span class="err">price:</span> <span class="err">&#39;699.99&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">id:</span> <span class="err">&#39;4wqrqw4890ipoiq&#39;,</span>
</span><span class='line'>    <span class="err">name:</span> <span class="err">&#39;Fine</span> <span class="err">Sheet&#39;,</span>
</span><span class='line'>    <span class="err">thread_count:</span> <span class="err">400,</span>
</span><span class='line'>    <span class="err">size:</span> <span class="err">&#39;Queen&#39;,</span>
</span><span class='line'>    <span class="err">price:</span> <span class="err">&#39;699.99&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We also need to store transactional data and Relational databases have been successfully used for transactions. So, a simple schema may look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="no">Sales</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">store_id</span><span class="p">,</span> <span class="n">product_id</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With a hybrid persistence approach like this, just beware that implementing simple features as follows will need more roundtrips:</p>

<ol>
<li>Show the invoice for sale with product <b>name</b>, quantity and price.</li>
<li>Show all &#8216;Fine Sheets&#8217; that are sold in the &#8216;Brentwood&#8217; store.</li>
<li>List all products sold today, sorted by <b>name</b>.</li>
</ol>


<p>Hybrid persistence works fine for caching. But whenever your data is split into multiple sources in way that you&#8217;d have to combine the parts from each, it&#8217;s not gonna be fun time. Just so you know.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/14/how-much-to-validate/">How Much to Validate?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-14T15:22:00-07:00" pubdate data-updated="true">Dec 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Input validation is often required to safe guard against inappropriate use. For example, consider the following API:</p>

<figure class='code'><figcaption><span>TransfersController.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">TransfersController</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span><span class="p">()</span>
</span><span class='line'>    <span class="n">from_account_id</span><span class="p">,</span> <span class="n">to_account_id</span><span class="p">,</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:from_account_id</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:to_account_id</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:amount</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">from_account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">from_account_id</span><span class="p">)</span>
</span><span class='line'>    <span class="n">to_account</span> <span class="o">=</span> <span class="no">Account</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">to_account_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@transfer</span> <span class="o">=</span> <span class="no">Transfer</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</span><span class='line'>    <span class="n">redirect_to</span> <span class="vi">@transfer</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, the API is expecting a <code>from_account_id</code> which we know, can be easily exploited unless a validation is performed on the server. Say, a simple validation would do this:</p>

<figure class='code'><figcaption><span>TransfersController.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">TransfersController</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span><span class="p">()</span>
</span><span class='line'>    <span class="c1">#...</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">from_account</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">current_user</span>
</span><span class='line'>      <span class="vi">@transfer</span> <span class="o">=</span> <span class="no">Transfer</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">from_account</span><span class="p">,</span> <span class="n">to_account</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</span><span class='line'>      <span class="c1">#...</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">render</span> <span class="ss">:unautorized</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is an absolutely necessary validation to be performed on the server.</p>

<p>However, the validation requirements can be a little relaxed at times. For example, if you know the only client of your API is also your own app, then you may not need to handle all possible validations both in the server and cliend side and come up with fancy errors. When its non-destructive, an invalid request can just be shown the general purpose error page, since this is only for bad users trying to hack the API calls.</p>

<p>For example, lets say we have the following code:</p>

<figure class='code'><figcaption><span>AppointmentsController.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">AppointmentsController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:user_id</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:date</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="vi">@appointments</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">appointments</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Say, by business logic, everyone can see the apointments for any user. Now, the above code will surely fail if any of <code>user_id/date</code> is not provided, or has a bad data. So, its possible to add the validation logic. But if I know I&#8217;m writing the only client that&#8217;s supposed to hit this API using a client side validated request, I&#8217;d just skip the input validation. This is not destructive anyway.</p>

<p>I think it&#8217;s a trade-off between paranoid programming and pragmatic design. As long as I&#8217;m providing expected behavior in the app without opening up a security hole, some validations may be skipped on purpose.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/12/what-programming-language-should-i-learn-in-2013/">What Programming Language Should I Learn in 2013?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-12T16:11:00-07:00" pubdate data-updated="true">Dec 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I like the idea of learning one new programming language every year. This is also mentioned at <a href="http://pragprog.com/book/tpp/the-pragmatic-programmer">The Pragmatic Programmer Book</a>. I&#8217;m now looking for a new language to learn.</p>

<p>In 2011, I learned <a href="http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/">F#</a>, my first functional programming language experience. It&#8217;s a really nice language, especially if you&#8217;re familiar with the .Net class library and the windows development echo system in general. This was really fun, learned the basic concepts and building blocks of functional languages.</p>

<p>The direct impact of F# is, even if I&#8217;m not using F#, I&#8217;m consciously using the concepts in other languages. For example, Ruby comes with a handful of functional style methods in its <a href="http://www.ruby-doc.org/core-1.9.3/Array.html">Array/Enumerable API</a>, and so does UnderscoreJS. Not just that, I&#8217;m always watching for opporunities to reduce side-effects, use delayed execution and pass around blocks when it makes sense. Learning F# has improved my Ruby/JavaScript/C# coding as a direct result. One disclaimer here, I&#8217;ve failed to grasp the true concepts of <a href="" title="http://en.wikipedia.org/wiki/Monad_(category_theory)">Category Theory and Monads</a>, although I understand how to use these.</p>

<p>I also learned ObjectiveC in 2011 while working on a project with ThoughtWorks. This was fun, apart from the frustrations with the IDE. As a language, I actually liked it quite a lot, the way they handle dynamic message passing while still giving you compile errors looked really innovative to me. I believe there&#8217;s a lot of room for me to learn more about ObjectiveC and Cocoa framework in general. Please let me know if there&#8217;s a good open source project where I can see professional level ObjectiveC code.</p>

<p>2012 was my year of learning JavaScript. Don&#8217;t get me wrong, I&#8217;ve been writing JavaScript for some time now, but I think I really learned the language in 2012. Thanks to the influx of micro libraries, as well as their coolness, and seriousness. CoffeeScript made me immensely happy, too. Started writing a JavaScript book with <a href="http://isagoksu.com/">Isa Goksu</a>, too bad we didn&#8217;t get far with it :(</p>

<p>I&#8217;m yet to pick a new language for 2013. Any suggestion? Or, what are you learning in 2013?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/12/06/the-myth-of-one-assert-per-test/">The Myth of One Assert Per Test</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-06T09:55:00-07:00" pubdate data-updated="true">Dec 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p>TL;DR; It&#8217;s not one <code>assert</code> per test, rather one logical path per test.</p></blockquote>

<p>I find this to be a classical example of how an inappropriate choice of terminology leads to huge confusion. In trying to find the original source of the &#8220;one assertion per test&#8221; quote, google came back only with a bunch of confused blog entries :(</p>

<p>Without much ranting, lets see a code example to start with:</p>

<figure class='code'><figcaption><span>example code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">eligible_credit_card_types</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">annual_income</span> <span class="o">=</span> <span class="n">customer</span><span class="o">.</span><span class="n">annual_income</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">100_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;platinum&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">10_000</span><span class="p">),</span>
</span><span class='line'>     <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">8_000</span><span class="p">),</span>
</span><span class='line'>     <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">5_000</span><span class="p">)</span> <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">50_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">6_000</span><span class="p">),</span>
</span><span class='line'>    <span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">3_000</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">elsif</span> <span class="n">annual_income</span> <span class="o">&gt;</span> <span class="mi">30_000</span>
</span><span class='line'>    <span class="o">[</span><span class="no">CreditCard</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="s1">&#39;cashback&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="mi">1_500</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="o">[]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>By saying one logical path per test, I mean I&#8217;d write a total of 4 tests for this method, each covering a logical path. But I really don&#8217;t care about how many assert calls you need in each logical path to express the desired behavior. For example, this is totally fine:</p>

<figure class='code'><figcaption><span>example test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">context</span> <span class="s1">&#39;#eligible_credit_card_types&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;returns platinum, gold and cashback for people making over a 100K annually&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="c1">#setup customer, call the method</span>
</span><span class='line'>    <span class="n">cards</span> <span class="o">=</span> <span class="n">credit_card_authorizer</span><span class="o">.</span><span class="n">eligible_credit_card_types</span><span class="p">(</span><span class="n">customer</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">cards</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">cards</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">type</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">&#39;platinum&#39;</span>
</span><span class='line'>    <span class="n">cards</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">limit</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">10_000</span>
</span><span class='line'>    <span class="c1">#same for cards[1], cards[2]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Of course, this can indeed be converted into a single assertion, if you already had <code>equals</code> method overriden for the credit cards. But, I&#8217;d probably skip adding that code if its just for the sake of writing tests.</p>

<p><img class="right" src="/images/bowling.jpg" width="300" height="550">
<i>Image taken from mchenrybowl</i></p>

<p>The mechnical thought of &#8220;one assertion per test&#8221; is lame.</p>

<ol>
<li>If for nothing else, these silly assertions would multipy the running time of your test suite by a factor of digits.</li>
<li>Doesn&#8217;t provide you any additional coverage or safety.</li>
<li>As long as each of your tests cover a unique logical path, there&#8217;s only one logical reason why it&#8217;d fail, irrespective of how many assertions you put in there.</li>
</ol>


<p>But, there&#8217;s a but! If you need many asserts per test, the code is probably asking for some refactoring. It indicates that one logical path in your code is touching too many things. Worse, when it calls too many methods that belong to other objects. Testing such a logical path is hard, usually requires a big setup and a bigger assertion. In such cases, breaking down the test into multiple tests may yield some superficial readability of the test, but certainly works around the actual problem in the code without fixing it. Almost always, this indicates long procedural methods and I&#8217;d suggest taking a second look at it to refactor into a more OO code.</p>

<p>Happy Friday!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/11/28/readable-unit-tests/">Readable Unit Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-28T10:10:00-07:00" pubdate data-updated="true">Nov 28<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From my experience with writing/reading unit tests for years, here&#8217;s a little guideline to keep &#8216;em readable:</p>

<ol>
<li>A unit test needs to fit entirely (including setups) on a screen without scrolling.</li>
<li>It is OK to have a little bit of duplication in unit tests for readability.</li>
<li>Avoid nesting of contexts beyond 2 levels. Instead, use methods to setup and flatten.</li>
<li>Do not use if/else/loops in a unit test.</li>
<li>If your test needs too much setup/mocking/stubbing, time to refactor the code.</li>
</ol>


<p>A simple readable unit test is only achievable when the code itself is simple. Adhereing to these guideline will probably make the code simpler as a direct impact!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/9/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/7/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2021/01/17/software-architecture-part-3-writing/">Software Architecture - Topic 3: Writing</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/01/16/what-drives-me/">What Drives Me?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/30/software-architecture-part-2-people/">Software Architecture - Topic 2: People</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/26/software-artchitecture-part-1/">Software Architecture - Topic 1: Delightfulness</a>
      </li>
    
      <li class="post">
        <a href="/blog/2020/12/24/you-are-unfrogettable/">&#8220;you&#8217;re unfrogettable&#8221;</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>LinkedIn Profile</h1>
  <p>
    <a href="http://www.linkedin.com/in/sohan">SM Sohan</a>
  </p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/smsohan">@smsohan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'smsohan',
            count: ,
            skip_forks: ,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - SM Sohan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
