
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sohan's Blog</title>
  <meta name="author" content="SM Sohan">

  
  <meta name="description" content="At SourceFire, among other things, we build a cloud based Advanced Malware Protection software. As security products go, we collect a huge amount of &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://smsohan.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="" rel="alternate" title="Sohan's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37549931-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Sohan's Blog</a></h1>
  
    <h2>Things I'm Learning</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:smsohan.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/home">Home</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/lifeline">Lifeline!</a></li>
  <li><a href="/blog/2013/04/05/call-me-sohan-and-ask-me-not-about-sm/">Call me Sohan!</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/02/interesting-user-interaction-data-on-dashboard-widgets/">Interesting User Interaction Data on Dashboard Widgets</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-02T13:03:00-06:00" pubdate data-updated="true">Apr 2<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>At <a href="http://sourcefire.com">SourceFire</a>, among other things, we build a cloud based Advanced Malware Protection software. As security products go, we collect a huge amount of data about events that happen on the user devices so we can identify and potentially quarantine malicuous events. Security in itself is a big specialized domain, but this post is about a dashboard that we serve as the main point of entry into the big data that we collect from enterprises and consumers.</p>

<p>We were debating about what data to put on the dashboard. The target is to offer a very high level, but an actionable view of the whole enterprise data. In the end we settled down with a list of 7 types of data and decided to use a layout similar to the following.</p>

<p><img src="/images/dashboard_layout.png" alt="Layout" /></p>

<p>I was looking at the metrics this morning to see if our prioritization of the layout tiles made sense to the users and found that</p>

<blockquote><p>the number of clicks on each widget is highly correlated to its relative order in the layout.</p></blockquote>

<p>I am not sure how to interpret this result. It may mean one of:</p>

<ol>
<li>The ordering of the tiles matches the actual priority of our users.</li>
<li>Irrespective of the contents, users are more likely to click on data in this order.</li>
<li>The results are totally random and it&#8217;s more of a coincidence over a correlation.</li>
</ol>


<p>At this point, I feel we need to shuffle the tiles to see if the position has a strong bias on the results. When I get a chance to do this, will post again with my findings.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/18/mvcmailer-and-open-source-happiness/">MvcMailer and Open Source Happiness</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-18T09:17:00-06:00" pubdate data-updated="true">Mar 18<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>MvcMailer makes me happy as a developer.</p>

<p>I find an immense amount of happiness everytime I check the <a href="https://nuget.org/packages/MvcMailer/">Nuget page of MvcMailer</a>. It&#8217;s so refreshing to see the download count going up (42,427 total downloads as I write), receiving feedback, praises and even the complains.</p>

<p><img src="/images/mvcmailer_tweets.png" alt="MvcMailer Tweets" /></p>

<p>The idea of MvcMailer came from trying to bring some of the amazing <a href="http://guides.rubyonrails.org/action_mailer_basics.html">Ruby on Rails ActionMailer</a> features to ASP.NET MVC developers. It was well accepted since the very beginning and I hope is still helping people. As a side-effect, MvcMailer gives me an opportunity to keep in touch with the developments in ASP.NET MVC, C#, the .NET framework and the community around these. During our Sunday coffee and code seessions, I usually pair up with <a href="http://codecuriosity.com/">Tyler Mercier</a>, and MvcMailer is often the project we&#8217;d work on, or at least talk about. It also gives me a code to share on my <a href="https://github.com/smsohan/MvcMailer">github profile</a>, which I expect a good future employer to care about :)</p>

<p>Yesterday, we met for Coffee and Code and released a new version to better work with .NET 4.5. This has been the most requested feature in the last couple months and required a small code change. After we released it, I drove home in about 20 minutes. Checked the counts, and it had already seen 4 downloads. This felt just amazing. Now after about 20 hours, it feels even better to see 100+ downloads of the new release. It feels so good.</p>

<p>Open source is truly rewarding, both to its contributors and to its consumers.</p>

<p>Happy open sourcing.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/07/solution-architecting/">Solution Architecting Using Queues?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-07T14:44:00-07:00" pubdate data-updated="true">Mar 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When building a bunch of applications that need to interact with each other, Queues or <a href="http://en.wikipedia.org/wiki/Message-oriented_middleware">Message Oriented Middleware</a> services offer some very useful features. To name a few, you get features like a) <strong>Guaranteed message delivery</strong>, b) <strong>routing</strong>, c) <strong>throttling</strong>, etc., for free. Tools like ActiveMQ, RabbitMQ, MSMQ, JMS servers are tuned and time tested to handle such requirements robustly. I&#8217;ve had good experience with these tools for the happy paths. However, when dealing with unhappy paths, irrespective of the tools you use, it can be quite challenging to design the failovers.</p>

<p>Here&#8217;s a list of the things to consider when designing a solution using Queues:</p>

<h3>Speed of Consumption</h3>

<p>Queues are essentially a producer/consumer or pub/sub system. This means a slower consumption rate results into a pileup of messages. In a high transaction system, millions of records can pile up in the matter of hours - forcing the producer to slow down or messaages being dropped. While architecting a solution, the rates should be measured and tested. Load tests are very useful to avoid such production issues. These issues are generally hard to fix once rolled out.</p>

<h3>Error Paths</h3>

<p>Even when a consumer is keeping up with the producer, chances are some messages cannnot be processed due to errors. If it&#8217;s a network error or some other error external to the system, a simple redelivery from the queue may fix it. But in real life, chances are, this is an application defect. So, a simple retry won&#8217;t make any difference. The application defect needs to be fixed and then, the message needs to be replayed. The solution needs to be designed considering the effect/resolution of the error paths.</p>

<h3>Automated Monitoring</h3>

<p>Automated monitoring is crucial to any Queue in the production system. Without monitoring, the queue may be flooded with unconsumed messages.</p>

<h3>Human Intervention</h3>

<p>When a message cannot be processed by a consumer, chances are, a human intervention will be required to complete/undo the intended operation. For example, if your payment processing application sends out a message on complete, and the shipping processor fails to process it - a human interaction may be required to fulfill the shipping or undo the order. When designing a solution, such edge cases should be identified.</p>

<h3>Deployments</h3>

<p>Typically queues are good in terms of holding the unconsumed messages for disconnected consumers. However, if a consumer has significant downtime between deployments, this can stretch the limits of the queue.</p>

<p>I&#8217;m sure this is not all. These are from my real-life experience only. If you have experiences to share, please use the comments below.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/27/random-data-in-tests/">Random Data in Tests</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-27T15:24:00-07:00" pubdate data-updated="true">Feb 27<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&#8230; are evil if you expect the randomizer to give you unique values on each call.</p>

<p>Here&#8217;s an example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>  <span class="vi">@user_1</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="s2">&quot;email-</span><span class="si">#{</span><span class="no">Random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">@example.com&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># the following will fail intermittently if you have a unique validation on User#email</span>
</span><span class='line'>
</span><span class='line'>  <span class="vi">@user_2</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create!</span><span class="p">(</span><span class="n">email</span><span class="p">:</span> <span class="s2">&quot;email-</span><span class="si">#{</span><span class="no">Random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s2">@example.com&quot;</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s a timebomb, use it, it will haunt you later. Be sane, stop using random numbers in tests like this.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/25/practial-challenges-with-client-side-mvc/">Practical API Design Challenges for Client Side MVC</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-25T22:40:00-07:00" pubdate data-updated="true">Feb 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This following list is probably a subset of a bigger one, but I&#8217;ve composed it based on my experience using BackboneJS + Rails on the current project at work. So, here goes the list:</p>

<h3>Designing Granularity of the API</h3>

<p>Using RESTful API, it makes sense to have separate API methods to repesent each type of resource. However, to construct a meaninful UI for the end user, often time we need to represent multiple resources on the same screen. Let&#8217;s explain this with an example requirement:</p>

<p>As a user I want to see the <strong>emails</strong> using a saved <strong>custom filter</strong></p>

<p>In this case, we would want the UI to show the description of the selected filter, and also the emails matching the filter. Conceptually, <code>CustomFilter</code> and <code>Email</code> are two resources or models, having distinct properties and behaviors. It&#8217;d make sense to have two separate API&#8217;s as follows:</p>

<p><strong>Filter API:</strong>
GET http://fancy_domain.com/filters/emails_from_boss_about_release</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="err">id:</span> <span class="err">10,</span>
</span><span class='line'>  <span class="err">filter_name:</span> <span class="err">emails_from_boss_about_release,</span>
</span><span class='line'>  <span class="err">subject_including:</span> <span class="err">&#39;release&#39;,</span>
</span><span class='line'>  <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Email API:</strong>
GET http://fancy_domain.com/filters/10/emails</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">[</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">subject:</span> <span class="err">&#39;Release</span> <span class="err">note&#39;,</span>
</span><span class='line'>    <span class="err">from:</span> <span class="nt">&quot;boss@the_company.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">to:</span> <span class="nt">&quot;sohan@the_company.com&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">body:</span> <span class="nt">&quot;&lt;html&gt;.. &lt;/html&gt;&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="err">sent_at:</span> <span class="nt">&quot;20130102040511&quot;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Although this granularity makes good sense as an API, it starts causing issues for typical client side MVC use case.</p>

<blockquote><p>Unless the data from these two API methods are combined on the server side, the client must make two requests.</p></blockquote>

<p>In a real world use, I&#8217;ve seen it&#8217;s more common for the UI to require multiple resources than not. Since, we want our users to get faster response, we try to create API&#8217;s that suit the UI&#8217;s need. So, APIs start getting bloated payloads to match the UI&#8217;s need. This typically results into something like the following:</p>

<p><strong>Filter Email API:</strong>
GET http://fancy_domain.com/filters/emails_from_boss_about_release?include_emails=true</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="err">id:</span> <span class="err">10,</span>
</span><span class='line'>  <span class="err">filter_name:</span> <span class="err">&#39;emails_from_boss_about_release&#39;,</span>
</span><span class='line'>  <span class="err">subject_including:</span> <span class="err">&#39;release&#39;,</span>
</span><span class='line'>  <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;,</span>
</span><span class='line'>  <span class="err">emails:</span>
</span><span class='line'>  <span class="err">[</span>
</span><span class='line'>    <span class="err">{</span>
</span><span class='line'>      <span class="err">subject:</span> <span class="err">&#39;Release</span> <span class="err">note&#39;,</span>
</span><span class='line'>      <span class="err">from:</span> <span class="err">&#39;boss@the_company.com&#39;,</span>
</span><span class='line'>      <span class="err">to:</span> <span class="err">&#39;sohan@the_company.com&#39;,</span>
</span><span class='line'>      <span class="err">body:</span> <span class="err">&#39;&lt;html&gt;..</span> <span class="err">&lt;/html&gt;&#39;,</span>
</span><span class='line'>      <span class="err">sent_at:</span> <span class="err">20130102040511</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">]</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is an example with just two resources. I&#8217;ve seen UI&#8217;s that need more than two resources, and its quite common as well.</p>

<h3>Short/Medium/Long form of Models/Resources</h3>

<p>The view usually renders a subset of all possible attributes associated with a model.</p>

<p>For example, when rendering the <code>WeatherForecast</code> model, in the list view only the minimum and maximum temperature for the day with a short summary of Sunny/Cloudy/Rainy/Snowy are shown. However, when you want to see more, you&#8217;d want to show the hourly variation of the weather with additional data of interest.</p>

<p>This requires the RESTful API to prepare multiple respresentations of a resource to suit the specific UI needs. This can complicate the logic on both the server and client sides, since the code must accommodate different representations for the same model.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/07/activerecord-callbacks/">Are ActiveRecord Callbacks Any Good?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-07T09:04:00-07:00" pubdate data-updated="true">Feb 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Wanted to share my thoughts on ActiveRecord Callbacks. I&#8217;d like to know your thoughts if you disagree. Please use the comments.</p>

<ul>
<li>Only use them when the behavior is <b>must have</b> under all situations, including your tests. For example, we know email addresses are case-insensitive. So no matter what, we may always want to store a lower cased version in the db.</li>
</ul>


<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Good</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:downcase_email</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">downcase_email</span>
</span><span class='line'>    <span class="n">email</span><span class="o">.</span><span class="n">downcase!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Never use them otherwise. A couple of classic examples that I consider as bad:</li>
</ul>


<figure class='code'><figcaption><span>user.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Bad: Sends email, probably not required under all situations such as when creating via migrations, tests etc.</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_create</span> <span class="ss">:welcome</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">welcome</span>
</span><span class='line'>    <span class="no">WelcomeMailer</span><span class="o">.</span><span class="n">welcome</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="o">.</span><span class="n">deliver</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#Bad: Interacts with external components</span>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after_create</span> <span class="ss">:setup_orientation</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">setup_orientation</span>
</span><span class='line'>    <span class="no">OrientationMessageQueue</span><span class="o">.</span><span class="n">enque</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>A common problem with the callbacks is, there are some handy methods that skip the callbacks. For example, consider the following:</li>
</ul>


<figure class='code'><figcaption><span>User.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#Careful</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_save</span> <span class="ss">:update_coordinates</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">update_coordinates</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="no">Geo</span><span class="o">.</span><span class="n">find_coordinates</span><span class="p">(</span><span class="n">zip_code</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#works fine</span>
</span><span class='line'><span class="n">sohan</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by_name</span><span class="p">(</span><span class="s1">&#39;Sohan&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">sohan</span><span class="o">.</span><span class="n">zip_code</span> <span class="o">=</span> <span class="s1">&#39;33333&#39;</span>
</span><span class='line'><span class="n">sohan</span><span class="o">.</span><span class="n">save!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#doesn&#39;t fire the callback</span>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">update_all</span><span class="p">({</span><span class="n">zip_code</span><span class="p">:</span> <span class="s1">&#39;33333&#39;</span><span class="p">},</span> <span class="p">{</span><span class="n">zip_code</span><span class="p">:</span> <span class="s1">&#39;55555&#39;</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you&#8217;re using the callbacks, I&#8217;d emphasize again, only use when you are absolutely sure the desired behavior applies under all contexts.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/24/rejecting-because-it-didnt-work-last-time/">Rejecting Because It Didn&#8217;t Work Last Time</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-24T11:09:00-07:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&#8230; is as right as &#8220;the weather will be bad today because it wasn&#8217;t any good yesterday&#8221;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/21/on-activerecord-query-enhancers/">On ActiveRecord Query Enhancers</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-21T16:43:00-07:00" pubdate data-updated="true">Jan 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The question is, should we use the third-party ActiveRecord Query Enhancers like SearchLogic/Squeel/MetaSearch?</p>

<p>Quoting from <a href="https://github.com/ernie/squeel">Squeel&#8217;s Github README</a> page,</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Squeel</span> <span class="n">lets</span> <span class="n">you</span> <span class="n">rewrite</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">where</span> <span class="o">[</span><span class="s1">&#39;created_at &gt;= ?&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="o">.</span><span class="n">weeks</span><span class="o">.</span><span class="n">ago</span><span class="o">]</span>
</span><span class='line'><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">as</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Article</span><span class="o">.</span><span class="n">where</span><span class="p">{</span><span class="n">created_at</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">.</span><span class="n">weeks</span><span class="o">.</span><span class="n">ago</span><span class="p">}</span>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">thing</span><span class="o">.</span> <span class="no">If</span> <span class="n">you</span> <span class="n">don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">agree</span><span class="p">,</span> <span class="no">Squeel</span> <span class="n">might</span> <span class="ow">not</span> <span class="n">be</span> <span class="k">for</span> <span class="n">you</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<p>At work, we are migrating a Rails 3.0 project into Rails 3.2. We used MetaSearch in the project quite extensively and now discussing if using Squeel (successor of MetaSearch for newer Rails versions) would be a good decision. I recognized there are good points on both sides of the debate and wanted to capture the list here for a reference.</p>

<h3>You&#8217;d want to use such enhancers because:</h3>

<ol>
<li>They extend the basic AR API to provide a DSL. For example, Squeel provides you an API so you can write the following:
<code>User.where{ country != "USA" &amp;&amp; drives_truck == true }</code>
Instead of this Activ eRecord Query:
<code>User.where('country &lt;> ? &amp;&amp; drives_truck = ? ', 'USA', true)</code></li>
<li>They write complex join statements, including outer joins and joining multiple tables, for you using a shorthand. e.g. <code>User.where{company_name_eq 'Coders'}</code></li>
<li>They support negative logic (not equal, not in) and OR SQL queries that would require raw String queries using ActiveRecord API.</li>
<li>They provide fancy operations such as <code>User.where{name_or_address_contains 'scott'}</code> that would require some raw String when using AR directly.</li>
</ol>


<h3>You&#8217;d avoid using these enhancers because:</h3>

<ol>
<li>You think that using String is just fine over using a Hash with hardcoded symbols anyway.</li>
<li>As new versions of AR are released, there&#8217;s little guarantee the third-party API will still be compatible.</li>
<li>You are concerned about adding another pile of abstractions and magic on top of ActiveRecord.</li>
</ol>


<p>Please share if you prefer one over another and if you do, please let us know why.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/17/abusing-json/">MongoDB Is Abusing JSON!</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-17T16:11:00-07:00" pubdate data-updated="true">Jan 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I find the MongoDB API is abusing JSON in a really bad way. JSON is probably a good format for storing the documents in MongoDB, but using JSON for it&#8217;s weird API is simply a terrible idea. Here&#8217;s an example from the <a href="http://docs.mongodb.org/manual/reference/sql-aggregation-comparison/">SQL to Aggregation Framework Mapping Chart</a></p>

<figure class='code'><figcaption><span>MongoDB Example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'>  <span class="nx">db</span><span class="p">.</span><span class="nx">orders</span><span class="p">.</span><span class="nx">aggregate</span><span class="p">(</span> <span class="p">[</span>
</span><span class='line'>     <span class="p">{</span> <span class="nx">$group</span><span class="o">:</span> <span class="p">{</span> <span class="nx">_id</span><span class="o">:</span> <span class="p">{</span> <span class="nx">cust_id</span><span class="o">:</span> <span class="s2">&quot;$cust_id&quot;</span><span class="p">,</span>
</span><span class='line'>                        <span class="nx">ord_date</span><span class="o">:</span> <span class="s2">&quot;$ord_date&quot;</span> <span class="p">},</span>
</span><span class='line'>                 <span class="nx">total</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$sum</span><span class="o">:</span> <span class="s2">&quot;$price&quot;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>
</span><span class='line'>     <span class="p">{</span> <span class="nx">$match</span><span class="o">:</span> <span class="p">{</span> <span class="nx">total</span><span class="o">:</span> <span class="p">{</span> <span class="nx">$gt</span><span class="o">:</span> <span class="mi">250</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span> <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>I find the UI of this query to be distasteful at the best. Here&#8217;s an SQL example of the same:</p>

<figure class='code'><figcaption><span>SQL Equivalent</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'>  <span class="k">SELECT</span> <span class="n">cust_id</span><span class="p">,</span>
</span><span class='line'>         <span class="n">ord_date</span><span class="p">,</span>
</span><span class='line'>         <span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">AS</span> <span class="n">total</span>
</span><span class='line'>  <span class="k">FROM</span> <span class="n">orders</span>
</span><span class='line'>  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">ord_date</span>
</span><span class='line'>  <span class="k">HAVING</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">250</span>
</span></code></pre></td></tr></table></div></figure>


<p>I find this SQL example to be a few magnitudes more readable than the JSON one. The JSON query in this example, is full of hacks. Every time I see a &#8220;$&#8221; sign, I&#8217;m totally confused about what it means. For example, consider this fragment, total: { $sum: &#8220;$price&#8221; } and compare it to SUM(price) AS total.</p>

<p>I think MongoDB has its strengths. But for haven&#8217;s sake, if they can&#8217;t find any better, they should leave this JSON ugliness in favor of SQL as a query interface to MongoDB. What do you think?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/08/hybrid-persistence/">Hybrid Persistence</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-08T15:08:00-07:00" pubdate data-updated="true">Jan 8<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Often times the business requirements demand for database features that aren&#8217;t easily achievable using a single type of database. And now we have quite a few options to choose from, for example Key Value stores, Document databases, Relational databases etc, each providing some mutually exclusive features from the rest. So, it can be tempting to introduce multiple databases to rip the benefits of each.</p>

<p>But, it comes with a few gotchas that are worth knowing. Here&#8217;s a short list from my recent experience on a project:</p>

<ol>
<li>No simple way to join data from multiple databases without multiple round trips.</li>
<li>Deployment is tricky as it adds more infrastructure.</li>
<li>If data is duplicated, migrations need to address multiple sources.</li>
</ol>


<p>Let&#8217;s explain this with an example. Say, we need to store data for an e-commerce site. Document stores seem to be good candidate for storing the product info, since different products have different data associated with it.</p>

<figure class='code'><figcaption><span>products.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='json'><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">id:</span> <span class="err">&#39;4wqrqw4890ipoip&#39;,</span>
</span><span class='line'>    <span class="err">name:</span> <span class="err">&#39;iPhone</span> <span class="err">5&#39;,</span>
</span><span class='line'>    <span class="err">color:</span> <span class="err">&#39;Black&#39;,</span>
</span><span class='line'>    <span class="err">price:</span> <span class="err">&#39;699.99&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="err">id:</span> <span class="err">&#39;4wqrqw4890ipoiq&#39;,</span>
</span><span class='line'>    <span class="err">name:</span> <span class="err">&#39;Fine</span> <span class="err">Sheet&#39;,</span>
</span><span class='line'>    <span class="err">thread_count:</span> <span class="err">400,</span>
</span><span class='line'>    <span class="err">size:</span> <span class="err">&#39;Queen&#39;,</span>
</span><span class='line'>    <span class="err">price:</span> <span class="err">&#39;699.99&#39;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We also need to store transactional data and Relational databases have been successfully used for transactions. So, a simple schema may look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="no">Sales</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">store_id</span><span class="p">,</span> <span class="n">product_id</span><span class="p">,</span> <span class="n">quantity</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>With a hybrid persistence approach like this, just beware that implementing simple features as follows will need more roundtrips:</p>

<ol>
<li>Show the invoice for sale with product <b>name</b>, quantity and price.</li>
<li>Show all &#8216;Fine Sheets&#8217; that are sold in the &#8216;Brentwood&#8217; store.</li>
<li>List all products sold today, sorted by <b>name</b>.</li>
</ol>


<p>Hybrid persistence works fine for caching. But whenever your data is split into multiple sources in way that you&#8217;d have to combine the parts from each, it&#8217;s not gonna be fun time. Just so you know.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/9/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/7/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2021/06/18/architecture-realtime/">Software Architecture - Topic 6 - Slack and Microsoft Teams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/04/23/architecture-mongodb/">Software Architecture - Topic 5 - MongoDB</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/03/04/architecture-redis/">Software Architecture - Topic 4 - Redis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/02/19/frontend-engineering/">Can I Have a Career as a Frontend Engineer?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2021/01/17/software-architecture-part-3-writing/">Software Architecture - Topic 3: Writing</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>LinkedIn Profile</h1>
  <p>
    <a href="http://www.linkedin.com/in/sohan">SM Sohan</a>
  </p>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/smsohan">@smsohan</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'smsohan',
            count: ,
            skip_forks: ,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - SM Sohan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
