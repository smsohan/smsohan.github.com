---
layout: post
title: "Verify Correct DateTime data in method call using NMock"
date: 2008-03-18
comments: false
categories:
 - C#
 - .Net
 - Object Oriented Design
---

<div class='post'>
Recently I was writing unit test for a method of the following signature<br /><br /><span style="color: rgb(0, 0, 255);font-family:Courier New;">interface <span style="color: rgb(61, 133, 198);">ICache</span><br /><span style="color: rgb(0, 0, 0);">{</span><br /> void </span><span style="font-family:Courier New;">Insert(</span><span style="color: rgb(0, 0, 255);font-family:Courier New;">string </span><span style="font-family:Courier New;">key, </span><span style="color: rgb(0, 0, 255);font-family:Courier New;">object </span><span style="font-family:Courier New;">value, </span><span style="color: rgb(61, 133, 198);font-family:Courier New;">DateTime</span><span style="font-family:Courier New;"> absoluteExpiration, </span><span style="color: rgb(111, 168, 220);font-family:Courier New;">TimeSpan</span><span style="font-family:Courier New;"> slidingExpiration);<br />}<br /><br /><span style="font-family:Verdana;">and I wanted to verify the following call -</span><br /><br />Insert(<span style="color: rgb(102, 0, 0);">"key"</span>, <span style="color: rgb(102, 0, 0);">"value"</span>, <span style="color: rgb(61, 133, 198);">DateTime</span>.Now.AddMinutes(30), <span style="color: rgb(111, 168, 220);">TimeSpan</span>.Zero);<br /><br /><br /><span style="font-family:Verdana;">However, you readily see the problem in verifying with the above call for the presence of </span></span><span style="font-family:Courier New;"><span style="color: rgb(61, 133, 198);font-family:Verdana;">DateTime</span><span style="font-family:Verdana;">.Now.AddMinutes(30) in the argument. So, a test method like the following won't work for obvious reason.</span><br /><span style="color: rgb(61, 133, 198);">ICache </span>cache = _mocks.NewMock&lt;<span style="color: rgb(61, 133, 198);">ICache</span>&gt;();<br /><span style="color: rgb(61, 133, 198);">Expect</span>.Once.On(cache).Method("Insert").With(<span style="color: rgb(204, 0, 0);">"key"</span>, <span style="color: rgb(204, 0, 0);">"value"</span>, DateTime.Now.AddMinutes(30), TimeSpan.Zero);<br /></span><br /><br /><span style="font-family:Verdana;">The reason that the above sample code wont work is, my test code called DateTime.Now.AddMinutes(30) before the production code actually did it. So, it is highly probable that the two version of DateTime.Now.AddMinutes(30) in the test code and production code are not same.<br /><br />To find a work around to this problem, I changed my assumption a little. I set my assumption that the value for the '</span><span style="font-family:Courier New;"><span style="font-family:Verdana;">absoluteExpiration' parameter must lie in between 29 and 31 minutes from now. So, I modified my test method like the following call-</span><br /><br /><span style="color: rgb(11, 83, 148);">Expect</span>.Once.On(cache).Method(<span style="color: rgb(204, 0, 0);">"Insert"</span>).With(<span style="color: rgb(204, 0, 0);">"key"</span>, <span style="color: rgb(204, 0, 0);">"value"</span>, Is.NotNull &amp; Is.AtLeast(DateTime.Now.AddMinutes(29)) &amp; Is.AtMost(DateTime.Now.AddMinutes(31)), TimeSpan.Zero);<br /><br /><span style="font-family:Verdana;">This advanced level of NMock usage may show you a way in similar needs. For more insight to this solution, you may wish to visit </span><a style="font-family: Verdana;" title="http://nmock.org/advanced.html" target="_blank" href="http://nmock.org/advanced.html" id="bo.8">http://nmock.org/advanced.html</a><br /><br /><br /></span><span style="font-family:Courier New;"><br /></span></div>
