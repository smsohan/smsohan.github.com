---
layout: post
title: "Object Versioning is an Open Design Problem"
date: 2012-01-17
comments: false
categories:
 - Architecture
 - Database
 - Object Oriented Design
---

<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on"><br /><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://farm3.staticflickr.com/2517/3874492115_e69defd351.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="213" src="http://farm3.staticflickr.com/2517/3874492115_e69defd351.jpg" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">This unsolvable maze is a local food from Bangladesh, known as Jilapi<br />Photo credits to&nbsp;<span style="background-color: #fefefe; color: blue; font-family: Arial, Helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left; text-decoration: none;"><a href="http://www.flickr.com/photos/udvranto_pothik/" style="background-color: #fefefe; font-family: Arial, Helvetica, sans-serif; font-size: 12px; line-height: 18px; text-align: left; text-decoration: none;">udvranto pothik</a></span></td></tr></tbody></table>Object Versioning is often required by a business rule, for example, to maintain an audit trail or to be able to revert to a previous version, etc. This is the 3rd time in my career where this Object Versioning requirement made me think like -<br /><blockquote class="tr_bq">There's gotta be an easier solution!&nbsp;</blockquote>But, I am yet to find one. So, I am thinking it's one of those open design problems, may be.<br /><br />To clarify the requirement with an example, let's consider the following scenario:<br /><br />A lawyer is preparing a document for one of her clients using a software. On January 17th, she needs to take a look at the version of the same document from May last year so that she can backtrace some changes that took place during these months.<br /><br />Lets assume the lawyer is using a software that stores the documents in a relational database with the following schema.<br /><pre>A Document has many Evidences, each provided by an EvidenceProvider<br /><br />Document (id, client_id, case_id, name)<br />Evidence (id, document_id, evidence_provider_id, details)<br />EvidenceProvider(id, name)<br /></pre>Now, given the versioning requirement how would you design your data model?<br /><br />Here's a couple of points that your design should address at a minimum:<br /><ul style="text-align: left;"><li>Going back to a version means a complete snapshot of the old version of the document. So, the version of May 1st should only bring the evidences that were there on that very day.</li><li>As a new version is created, it should inherit all previous evidences.</li></ul>As I have mentioned earlier, I am yet to find a good data model that can take care of these concerns without over-complicating everything. Let me know if you got a beautiful solution to this problem.<br /><br />However, in my latest project, the requirement is even harder. It's somewhat like this:<br /><br />The lawyer may have some documents in the "work in progress version". This means, if she needs to print a document for the court, she only wants to print the last "good version", skipping the "work in progress version".<br /><br />Also, when there is such a "work in progress version", she needs to attach any new Evidence to both the last "good version" as well as to the "work in progress version".<br /><br />Well, now you see the design of a data model for Object Versioning becomes really messy and unintuitive.<br /><blockquote class="tr_bq">So, here's my question to you - how would you design a solution for this?</blockquote></div></div>
